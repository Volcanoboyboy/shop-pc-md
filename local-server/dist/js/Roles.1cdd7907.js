(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Roles"],{"1d4e":function(e,t,a){},"7db0":function(e,t,a){"use strict";var r=a("23e7"),o=a("b727").find,i=a("44d2"),n=a("ae40"),l="find",s=!0,c=n(l);l in[]&&Array(1)[l]((function(){s=!1})),r({target:"Array",proto:!0,forced:s||!c},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),i(l)},d649:function(e,t,a){"use strict";var r=a("1d4e"),o=a.n(r);o.a},f50e:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"roles"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[e._v("首页")]),a("el-breadcrumb-item",[e._v("权限管理")]),a("el-breadcrumb-item",[e._v("角色列表")])],1),a("el-card",{staticClass:"box-card"},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addRoleDialog.visible=!0}}},[e._v("添加角色")])],1)],1),a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-col",{attrs:{span:24}},[a("el-table",{attrs:{border:"",data:e.roles}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.children&&0!==r.children.length?e._e():[e._v(" 暂无权限 ")],e._l(r.children,(function(t){return a("el-row",{key:t.id,staticClass:"level1-row"},[a("el-col",{attrs:{span:4}},[a("el-tag",{attrs:{closable:""},on:{close:function(a){return e.delRight(t,r)}}},[e._v(e._s(t.authName))]),a("i",{staticClass:"el-icon-caret-right"})],1),a("el-col",{attrs:{span:20}},e._l(t.children,(function(t){return a("el-row",{key:t.id,staticClass:"level2-row"},[a("el-col",{attrs:{span:6}},[a("el-tag",{attrs:{closable:"",type:"success"},on:{close:function(a){return e.delRight(t,r)}}},[e._v(e._s(t.authName))]),a("i",{staticClass:"el-icon-caret-right"})],1),a("el-col",{attrs:{span:18}},e._l(t.children,(function(t){return a("el-tag",{key:t.id,staticStyle:{margin:"5px 10px 5px 0"},attrs:{closable:"",type:"warning"},on:{close:function(a){return e.delRight(t,r)}}},[e._v(e._s(t.authName))])})),1)],1)})),1)],1)}))]}}])}),a("el-table-column",{attrs:{label:"#",type:"index"}}),a("el-table-column",{attrs:{label:"角色名称",prop:"roleName"}}),a("el-table-column",{attrs:{label:"角色描述",prop:"roleDesc"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(t){return e.editRoleDialog.open(r)}}}),a("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(t){return e.delRole(r)}}}),a("el-button",{attrs:{icon:"el-icon-setting",size:"mini",type:"warning"},on:{click:function(t){return e.assignRights(r)}}},[e._v("分配权限")])]}}])})],1)],1)],1)],1),a("el-dialog",{attrs:{title:e.assignRightsDialog.title,visible:e.assignRightsDialog.visible},on:{"update:visible":function(t){return e.$set(e.assignRightsDialog,"visible",t)}},scopedSlots:e._u([{key:"default",fn:function(){return[a("el-tree",{ref:"assignRightsDialogTreeRef",attrs:{"default-expand-all":"","show-checkbox":"",data:e.rights,"node-key":"id",props:{children:"children",label:"authName"}}})]},proxy:!0},{key:"footer",fn:function(){return[a("el-button",{on:{click:e.assignRightsDialog.onCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.assignRightsDialog.onOk}},[e._v("确 定")])]},proxy:!0}])}),a("el-dialog",{attrs:{title:e.addRoleDialog.title,visible:e.addRoleDialog.visible},on:{"update:visible":function(t){return e.$set(e.addRoleDialog,"visible",t)}},scopedSlots:e._u([{key:"default",fn:function(){return[a("el-form",{ref:"addRoleFormRef",attrs:{"label-width":"80px",model:e.addRoleDialog.form.data,rules:e.addRoleDialog.form.rules}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("el-input",{model:{value:e.addRoleDialog.form.data.roleName,callback:function(t){e.$set(e.addRoleDialog.form.data,"roleName","string"===typeof t?t.trim():t)},expression:"addRoleDialog.form.data.roleName"}})],1),a("el-form-item",{attrs:{label:"角色描述",prop:"roleDesc"}},[a("el-input",{model:{value:e.addRoleDialog.form.data.roleDesc,callback:function(t){e.$set(e.addRoleDialog.form.data,"roleDesc","string"===typeof t?t.trim():t)},expression:"addRoleDialog.form.data.roleDesc"}})],1)],1)]},proxy:!0},{key:"footer",fn:function(){return[a("el-button",{on:{click:e.addRoleDialog.onCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addRoleDialog.onOk}},[e._v("确 定")])]},proxy:!0}])}),a("el-dialog",{attrs:{title:e.editRoleDialog.title,visible:e.editRoleDialog.visible},on:{"update:visible":function(t){return e.$set(e.editRoleDialog,"visible",t)}},scopedSlots:e._u([{key:"default",fn:function(){return[a("el-form",{ref:"editRoleFormRef",attrs:{"label-width":"80px",model:e.editRoleDialog.form.data,rules:e.editRoleDialog.form.rules}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("el-input",{model:{value:e.editRoleDialog.form.data.roleName,callback:function(t){e.$set(e.editRoleDialog.form.data,"roleName","string"===typeof t?t.trim():t)},expression:"editRoleDialog.form.data.roleName"}})],1),a("el-form-item",{attrs:{label:"角色描述",prop:"roleDesc"}},[a("el-input",{model:{value:e.editRoleDialog.form.data.roleDesc,callback:function(t){e.$set(e.editRoleDialog.form.data,"roleDesc","string"===typeof t?t.trim():t)},expression:"editRoleDialog.form.data.roleDesc"}})],1)],1)]},proxy:!0},{key:"footer",fn:function(){return[a("el-button",{on:{click:e.editRoleDialog.onCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.editRoleDialog.onOk}},[e._v("确 定")])]},proxy:!0}])}),e.isShowP?a("p",{attrs:{id:"ppp"}},[e._v("asdfkjalsdkfjalsdfkjalsdkfjl")]):e._e(),a("button",{on:{click:e.showP}},[e._v("showP")])],1)},o=[],i=(a("99af"),a("4de4"),a("7db0"),a("4160"),a("a15b"),a("159b"),a("96cf"),a("1da1")),n=!1,l={name:"Roles",data:function(){var e=this;return{isShowP:!1,addRoleDialog:{visible:!1,title:"添加角色",form:{data:{roleName:"",roleDesc:""},rules:{roleName:[{required:!0,message:"请输入角色名称"}],roleDesc:[{required:!0,message:"请输入角色描述"}]}},onOk:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.addRoleFormRef.validate();case 3:return t.next=5,e.$request.post("roles",e.addRoleDialog.form.data);case 5:a=t.sent,201===a.data.meta.status?(e.addRoleDialog.visible=!1,e.loadRoles(),e.$refs.addRoleFormRef.resetFields()):e.$message.error(a.data.meta.msg),t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](0);case 11:case"end":return t.stop()}}),t,null,[[0,9]])})));function a(){return t.apply(this,arguments)}return a}(),onCancel:function(){e.addRoleDialog.visible=!1}},editRoleDialog:{visible:!1,title:"编辑角色",role:null,form:{data:{roleName:"",roleDesc:""},rules:{roleName:[{required:!0,message:"请输入角色名称"}],roleDesc:[{required:!0,message:"请输入角色描述"}]}},onOk:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.editRoleFormRef.validate();case 3:return t.next=5,e.$request.put("roles/".concat(e.editRoleDialog.role.id),e.editRoleDialog.form.data);case 5:a=t.sent,200===a.data.meta.status?(e.editRoleDialog.visible=!1,e.editRoleDialog.role.roleName=e.editRoleDialog.form.data.roleName,e.editRoleDialog.role.roleDesc=e.editRoleDialog.form.data.roleDesc):e.$message.error(a.data.meta.msg),t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](0);case 11:case"end":return t.stop()}}),t,null,[[0,9]])})));function a(){return t.apply(this,arguments)}return a}(),onCancel:function(){e.editRoleDialog.visible=!1},open:function(t){e.editRoleDialog.role=t,e.editRoleDialog.form.data.roleName=t.roleName,e.editRoleDialog.form.data.roleDesc=t.roleDesc,e.editRoleDialog.visible=!0}},rights:[],roles:[],assignRightsDialog:{title:"分配权限",visible:!1,role:null,rightIdsOfLeaf:[],onOk:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,o,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.assignRightsDialogTreeRef.getCheckedKeys(!1),r=e.$refs.assignRightsDialogTreeRef.getHalfCheckedKeys(),o=a.concat(r).join(","),t.next=5,e.$request.post("roles/".concat(e.assignRightsDialog.role.id,"/rights"),{rids:o});case 5:if(i=t.sent,200!==i.data.meta.status){t.next=15;break}return e.$message.success("授权成功"),e.assignRightsDialog.visible=!1,t.next=11,e.getRoleById(e.assignRightsDialog.role.id);case 11:n=t.sent,e.assignRightsDialog.role.children=n.children,t.next=16;break;case 15:e.$message.error(i.data.meta.msg);case 16:case"end":return t.stop()}}),t)})));function a(){return t.apply(this,arguments)}return a}(),onCancel:function(){e.assignRightsDialog.visible=!1}}}},methods:{showP:function(){this.isShowP=!0,this.$nextTick((function(){}))},delRole:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm('你确定要删除 "'.concat(e.roleName,'" 吗？'),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return a.next=5,t.$request.delete("roles/".concat(e.id));case 5:r=a.sent,200===r.data.meta.status?t.roles=t.roles.filter((function(t){return t.id!==e.id})):t.$message.error(r.data.meta.msg),a.next=11;break;case 9:a.prev=9,a.t0=a["catch"](0);case 11:case"end":return a.stop()}}),a,null,[[0,9]])})))()},delRight:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,a.$request.delete("roles/".concat(t.id,"/rights/").concat(e.id));case 2:o=r.sent,200===o.data.meta.status?(t.children=o.data.data,a.$notify.success({title:"成功",message:"删除成功"})):a.$message.error(o.data.meta.msg);case 4:case"end":return r.stop()}}),r)})))()},recursionFn:function(e){var t=this;e.forEach((function(e){e.children&&e.children.length>0?t.recursionFn(e.children):t.assignRightsDialog.rightIdsOfLeaf.push(e.id)}))},assignRights:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.assignRightsDialog.rightIdsOfLeaf=[],n){a.next=6;break}return a.next=4,t.$request.get("rights/tree");case 4:r=a.sent,200===r.data.meta.status?(t.rights=r.data.data,n=!0):t.$message.error(r.data.meta.msg);case 6:t.recursionFn(e.children),t.assignRightsDialog.role=e,t.assignRightsDialog.visible=!0,t.$nextTick((function(){t.$refs.assignRightsDialogTreeRef.setCheckedKeys(t.assignRightsDialog.rightIdsOfLeaf,!0)}));case 10:case"end":return a.stop()}}),a)})))()},loadRoles:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$request.get("roles");case 2:a=t.sent,200===a.data.meta.status?e.roles=a.data.data:e.$message.error(a.data.meta.msg);case 4:case"end":return t.stop()}}),t)})))()},getRoleById:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$request.get("roles");case 2:if(r=a.sent,200!==r.data.meta.status){a.next=7;break}return a.abrupt("return",r.data.data.find((function(t){return t.id===e})));case 7:t.$message.error(r.data.meta.msg);case 8:case"end":return a.stop()}}),a)})))()}},mounted:function(){this.loadRoles()}},s=l,c=(a("d649"),a("2877")),u=Object(c["a"])(s,r,o,!1,null,"3563385b",null);t["default"]=u.exports}}]);
//# sourceMappingURL=Roles.1cdd7907.js.map